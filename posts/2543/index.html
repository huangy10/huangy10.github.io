<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="随便写写"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>JS:图像截取部分(Image Cropping) - 治部少辅</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"><script src="https://cdn-city.livere.com/js/embed.dist.js" async></script></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/huangy10"><span>Github</span></a></li><li><a href="/archives"><span>Archives</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="https://i.loli.net/2018/11/05/5bdfeccbb2696.jpg"><div class="post-title"><h1 class="title">JS:图像截取部分(Image Cropping)</h1><ul class="meta"><li><i class="icon icon-author"></i>Woody Huang</li><li><i class="icon icon-clock"></i>8 Minutes</li><li><i class="icon icon-calendar"></i>March 13, 2019</li></ul></div></div><div class="article-content" style="max-width:800px"><p><img src="https://imgs.codewoody.com/uploads/big/8cd3e0e5fe6f9051e2c67646cc1e7dbc.jpg" alt="Cover"></p>
<p>这里我们讨论的图像截取部分是指从一个完整的大图中截取一小部分出来。当然，使用js实现。<br><a id="more"></a></p>
<blockquote>
<p>这边文章基本整理自<a href="https://yellowpencil.com/blog/cropping-images-with-javascript/" target="_blank" rel="noopener">Cropping images with Javascript</a>，<br>添加了一些我的评论</p>
</blockquote>
<p>例如，我们要从这样的大图中：</p>
<p><img src="https://imgs.codewoody.com/uploads/big/f6551d523ea8c642cd663a1b9b3e024d.jpeg" alt="大图"></p>
<p>截取出</p>
<p><img src="https://imgs.codewoody.com/uploads/big/2208ad7dfbd59e73fa2ba244fcb41487.jpeg" alt="小图"></p>
<p>使用H5中的canvas可以简单地解决这个问题。</p>
<h2 id="1-载入原图像"><a href="#1-载入原图像" class="headerlink" title="1. 载入原图像"></a>1. 载入原图像</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loadTimer;</span><br><span class="line"><span class="keyword">var</span> imgObject = <span class="keyword">new</span> Image();</span><br><span class="line">imgObject.src = <span class="string">'images/fozzie.jpg'</span>;</span><br><span class="line">imgObject.onLoad = onImgLoaded();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onImgLoaded</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (loadTimer != <span class="literal">null</span>) clearTimeout(loadTimer);</span><br><span class="line">  <span class="keyword">if</span> (!imgObject.complete) &#123;</span><br><span class="line">    loadTimer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      onImgLoaded();</span><br><span class="line">    &#125;, <span class="number">3</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    onPreloadComplete();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意这里我们为了演示是读取的图片文件内容，实际上除了图像文件，这里的“图像”还可以是其他形式，例如video元素，别的canvas等。</p>
</blockquote>
<h2 id="2-当图片完成载入以后，重新绘制你要截取的那一部分"><a href="#2-当图片完成载入以后，重新绘制你要截取的那一部分" class="headerlink" title="2. 当图片完成载入以后，重新绘制你要截取的那一部分"></a>2. 当图片完成载入以后，重新绘制你要截取的那一部分</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onPreloadComplete</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//call the methods that will create a 64-bit version of thumbnail here.</span></span><br><span class="line">  <span class="keyword">var</span> newImg = getImagePortion(imgObject, <span class="number">120</span>, <span class="number">150</span>, <span class="number">150</span>, <span class="number">80</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="comment">//place image in appropriate div</span></span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">"images"</span>).innerHTML = <span class="string">"&lt;img alt="</span><span class="string">" src="</span><span class="string">"+newImg+"</span><span class="string">" /&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>onPreloadComplete</code>函数会在图像载入完成以后调用。在这个函数中我们会调用实际完成图片截取的函数<code>getImagePortion</code></p>
<h2 id="3-图像截取"><a href="#3-图像截取" class="headerlink" title="3. 图像截取"></a>3. 图像截取</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">getImagePortion(imgObj, newWidth, newHeight, startX, startY, ratio)&#123;</span><br><span class="line"> <span class="comment">/* the parameters: - the image element - the new width - the new height - the x point we start taking pixels - the y point we start taking pixels - the ratio */</span></span><br><span class="line"> <span class="comment">//set up canvas for thumbnail</span></span><br><span class="line"> <span class="keyword">var</span> tnCanvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line"> <span class="keyword">var</span> tnCanvasContext = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"> tnCanvas.width = newWidth; tnCanvas.height = newHeight;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/* use the sourceCanvas to duplicate the entire image. This step was crucial for iOS4 and under devices. Follow the link at the end of this post to see what happens when you don’t do this */</span></span><br><span class="line"> <span class="keyword">var</span> bufferCanvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line"> <span class="keyword">var</span> bufferContext = bufferCanvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"> bufferCanvas.width = imgObj.width;</span><br><span class="line"> bufferCanvas.height = imgObj.height;</span><br><span class="line"> bufferContext.drawImage(imgObj, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/* now we use the drawImage method to take the pixels from our bufferCanvas and draw them into our thumbnail canvas */</span></span><br><span class="line"> tnCanvasContext.drawImage(bufferCanvas, startX,startY,newWidth * ratio, newHeight * ratio,<span class="number">0</span>,<span class="number">0</span>,newWidth,newHeight);</span><br><span class="line"> <span class="keyword">return</span> tnCanvas.toDataURL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的函数时原作者给出的方法，他先将图像完整地画到一个canvas(<code>bufferCanvas</code>)上，再将这个canvas对应的目标区域画到<code>tnCanvas</code>上，根据注释来看，似乎是出于性能或者适配方面的考虑。不过就我在开发桌面端网页时，可以直接将<code>imgObj</code>画到<code>tnCanvas</code>上。</p>
</blockquote>
<p>文章链接 <a href="http://www.codewoody.com/posts/2543/">http://www.codewoody.com/posts/2543/</a> </p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/教程/">教程</a><span class="tag-list-count">16</span></li></ul></div><div class="categories"><i class="icon icon-category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a><span class="category-list-count">16</span></li></ul></div></div><div class="article-comment" id="lv-container" data-id="city" data-uid="MTAyMC80MDkyMC8xNzQ0NQ==" style="max-width:800px"></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/posts/8446/"><i class="icon icon-arror-left"></i></a></li><li><a href="/posts/23804/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/huangy10" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://www.zhihu.com/people/woody-huang" title="Zhihu" target="_blank"><i class="icon icon-zhihu"></i></a></li><li><a href="mailto:woodyhuang1@gmail.com" title="Email" target="_blank"><i class="icon icon-email"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2019 治部少辅<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script><script src="https://www.googletagmanager.com/gtag/js?id=UA-114736006-1" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114736006-1');</script></body></html>